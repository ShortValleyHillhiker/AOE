(()=>{var y={spacing:16,baseRadius:4,rippleWidth:24,rippleSpeed:14,dragCooldown:50,maxRipples:25,fadeFactor:.9,frameRate:12};function z(t,e,l=y.baseRadius){let i=[],d=t.width-2*l,p=t.height-2*l,n=Math.floor(d/e),h=Math.floor(p/e),r=n*e,s=h*e,c=(t.width-r)/2,w=(t.height-s)/2;for(let u=0;u<=h;u++)for(let g=0;g<=n;g++)i.push({x:c+g*e,y:w+u*e});return i}function L(t,e,l){let i="#1c1c1c",d=t.canvas,p=document.querySelector("main");d.classList.contains("theme-aware")&&p?.classList.contains("inverted")&&(i="#1c1c1c"),d.classList.contains("theme-dark")&&(i="#1c1c1c"),t.fillStyle=i;for(let n=0;n<e.length;n++){let{x:h,y:r}=e[n],s=l(e[n]);s<=0||(t.beginPath(),t.arc(Math.round(h),Math.round(r),s,0,Math.PI*2),t.fill())}}function b(t,e,l=y.baseRadius){let i=t.parentElement;return t.width=i.clientWidth,t.height=i.clientHeight,z(t,e,l)}function G(t,e,l,i){let d=Math.floor(e),n=(Math.floor(l)*i+d)*4,[h,r,s]=t.data.slice(n,n+3);return(.299*h+.587*r+.114*s)/255}var{spacing:B,baseRadius:O}=y,W=1e3/12,k=10;function N(t){let e=t.getContext("2d"),i=t.parentElement.querySelector("img");if(!i)return;let d=document.createElement("canvas"),p=d.getContext("2d",{willReadFrequently:!0}),n=[],h=null,r=0,s=!1,c=!1,w=0,u=()=>{e.clearRect(0,0,t.width,t.height),L(e,n,({x:a,y:f})=>{let C=1+(1-G(h,a,f,t.width)-1)*r;return Math.round(O*C*2)})},g=()=>{p.drawImage(i,0,0,t.width,t.height),h=p.getImageData(0,0,t.width,t.height)},x=()=>{n=b(t,B),d.width=t.width,d.height=t.height,i.complete&&i.naturalWidth&&g()},o=a=>{if(a-w>=W&&(w=a,r=Math.min(r+1/k,1),u(),r>=1)){s=!1,c=!0;return}s&&requestAnimationFrame(o)},m=()=>{s||c||(s=!0,r=0,requestAnimationFrame(o))};i.onload=()=>{x(),u()},i.complete&&i.naturalWidth&&(x(),u()),window.addEventListener("resize",()=>{x(),u()}),new IntersectionObserver(([a])=>{a.isIntersecting&&!c&&setTimeout(m,350)},{threshold:.1}).observe(t)}function E(){document.querySelectorAll("canvas.ripple-canvas.halftone").forEach(N)}var{spacing:H,baseRadius:X,rippleWidth:A,rippleSpeed:Y,dragCooldown:P,maxRipples:_,fadeFactor:v,frameRate:V}=y,j=1e3/V;function J(t){let e=t.getContext("2d"),l=t.classList.contains("touch"),i=t.classList.contains("automatic"),d=t.classList.contains("loop"),p=b(t,H),n=[],h=0,r=!1,s=0,c=!1,w=!0,u=()=>{e.clearRect(0,0,t.width,t.height),L(e,p,({x:o,y:m})=>{let a=1;for(let f of n){if(f.alpha<.01)continue;let M=o-f.x,C=m-f.y;if(Math.abs(M)>f.radius+A||Math.abs(C)>f.radius+A)continue;let R=M*M+C*C,I=f.radius-A,q=f.radius+A;if(R<I*I||R>q*q)continue;let D=Math.sqrt(R),T=Math.abs(D-f.radius);a+=(1-T/A)*f.alpha*2}return Math.round(X*a)})},g=o=>{o-h>=j&&(h=o,u(),n=n.map(a=>({...a,radius:a.radius+Y,alpha:a.alpha*v})).filter(a=>a.alpha>.01),i&&Math.random()<.1&&x(Math.random()*t.width,Math.random()*t.height),d&&n.length===0&&x(t.width/2,t.height/2)),w&&(n.length||i||d||l&&r)?requestAnimationFrame(g):c=!1},x=(o,m)=>{w&&(n.length>=_&&n.shift(),n.push({x:o,y:m,radius:0,alpha:1}),c||(c=!0,requestAnimationFrame(g)))};l&&(t.addEventListener("pointerdown",o=>{r=!0;let m=t.getBoundingClientRect();x(o.clientX-m.left,o.clientY-m.top),s=Date.now()}),t.addEventListener("pointerup",()=>r=!1),t.addEventListener("pointermove",o=>{if(!r||Date.now()-s<P)return;let m=t.getBoundingClientRect();x(o.clientX-m.left,o.clientY-m.top),s=Date.now()})),window.addEventListener("resize",()=>{clearTimeout(t._resizeTimeout),t._resizeTimeout=setTimeout(()=>{p=b(t,H),u()},250)}),new IntersectionObserver(([o])=>{w=o.isIntersecting,w&&!c&&(c=!0,requestAnimationFrame(g))},{threshold:.1}).observe(t),u(),c||(c=!0,requestAnimationFrame(g))}function F(){document.querySelectorAll("canvas.ripple-canvas:not(.halftone)").forEach(J)}var K=new Swup;function S(){let t=document.getElementById("context-block"),e=document.getElementById("toggle-context");t&&e&&e.addEventListener("click",()=>{t.style.maxHeight?(t.style.maxHeight=t.scrollHeight+"px",requestAnimationFrame(()=>{t.style.maxHeight="0px",setTimeout(()=>{t.style.maxHeight=""},300)}),e.classList.remove("active")):(t.style.maxHeight=t.scrollHeight+"px",e.classList.add("active"))})}document.addEventListener("DOMContentLoaded",()=>{document.querySelector("canvas.halftone")&&E(),F(),S()});K.hooks.on("page:view",({visit:t})=>{document.querySelector("canvas.halftone")&&E(),F(),S()});})();
